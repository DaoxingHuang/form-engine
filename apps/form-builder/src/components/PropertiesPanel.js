import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useBuilderStore } from "@chameleon/engine-core";
import { OptionsEditor } from "@chameleon/form-ui";
import { ArrowLeft, Edit2, Trash2 } from "lucide-react";
const REGEX_PRESETS = [
    { label: "自定义", value: "", msg: "" },
    { label: "手机号 (中国)", value: "^1[3-9]\\d{9}$", msg: "请输入正确的11位手机号" },
    { label: "电子邮箱", value: "^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$", msg: "请输入有效的邮箱地址" },
    { label: "身份证号", value: "(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)", msg: "身份证格式不正确" }
];
const SUB_FIELD_TYPES = [
    { type: "text", label: "文本" },
    { type: "number", label: "数字" },
    { type: "date", label: "日期" },
    { type: "select", label: "下拉" },
    { type: "radio", label: "单选" },
    { type: "switch", label: "开关" },
    { type: "upload", label: "上传" }
];
const PropertiesPanel = () => {
    const { fields, selectedFieldId, editingSubFieldId, updateField, updateSubField, addSubField, removeSubField, setEditingSubFieldId } = useBuilderStore();
    const selectedField = fields.find((f) => f.id === selectedFieldId);
    const editingSubField = selectedField?.subFields?.find((sf) => sf.id === editingSubFieldId);
    if (!selectedField) {
        return (_jsxs("div", { className: "w-80 bg-white border-l border-gray-200 flex flex-col z-10 shadow-sm h-full", children: [_jsx("div", { className: "p-4 border-b border-gray-100 bg-gray-50/50", children: _jsx("h3", { className: "text-xs font-bold text-gray-500 uppercase tracking-wider", children: "\u5C5E\u6027\u914D\u7F6E" }) }), _jsx("div", { className: "flex-1 flex flex-col items-center justify-center text-gray-400 p-6 text-center bg-gray-50/30", children: _jsxs("p", { className: "text-sm font-medium", children: ["\u8BF7\u5728\u753B\u5E03\u4E2D\u9009\u62E9\u7EC4\u4EF6", _jsx("br", {}), _jsx("span", { className: "text-xs opacity-70", children: "\u70B9\u51FB\u7EC4\u4EF6\u4EE5\u7F16\u8F91\u5C5E\u6027" })] }) })] }));
    }
    // If editing a sub-field (inside an Array)
    if (editingSubField) {
        return (_jsxs("div", { className: "w-80 bg-white border-l border-gray-200 flex flex-col z-10 shadow-sm h-full animate-in slide-in-from-right-4 duration-200", children: [_jsxs("div", { className: "p-4 border-b border-gray-100 bg-indigo-50/50 flex items-center gap-2", children: [_jsx("button", { onClick: () => setEditingSubFieldId(null), className: "p-1 hover:bg-white rounded-full text-indigo-600 transition-colors", children: _jsx(ArrowLeft, { size: 16 }) }), _jsxs("div", { children: [_jsx("h3", { className: "text-xs font-bold text-indigo-900 uppercase tracking-wider", children: "\u5B50\u5B57\u6BB5\u914D\u7F6E" }), _jsx("p", { className: "text-[10px] text-indigo-400", children: editingSubField.id })] })] }), _jsxs("div", { className: "flex-1 overflow-y-auto p-4 space-y-6", children: [_jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u6807\u9898" }), _jsx("input", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all", value: editingSubField.title, onChange: (e) => updateSubField(selectedField.id, editingSubField.id, { title: e.target.value }) })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u5B57\u6BB5\u6807\u8BC6 (ID)" }), _jsx("input", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2 bg-gray-50 text-gray-500 font-mono", value: editingSubField.id, disabled: true })] }), _jsxs("div", { className: "flex items-center gap-2 pt-2", children: [_jsx("input", { type: "checkbox", id: "sf-required", checked: editingSubField.required, onChange: (e) => updateSubField(selectedField.id, editingSubField.id, { required: e.target.checked }), className: "rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" }), _jsx("label", { htmlFor: "sf-required", className: "text-sm text-gray-700", children: "\u5FC5\u586B\u9879" })] })] }), ["select", "radio", "checkbox"].includes(editingSubField.type) && (_jsxs("div", { className: "space-y-2 pt-2 border-t border-gray-100", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u9009\u9879\u914D\u7F6E" }), _jsx(OptionsEditor, { options: editingSubField.options, onChange: (opts) => updateSubField(selectedField.id, editingSubField.id, { options: opts }) })] }))] })] }));
    }
    // Main Field Properties
    return (_jsxs("div", { className: "w-80 bg-white border-l border-gray-200 flex flex-col z-10 shadow-sm h-full", children: [_jsxs("div", { className: "p-4 border-b border-gray-100 bg-gray-50/50", children: [_jsx("h3", { className: "text-xs font-bold text-gray-500 uppercase tracking-wider", children: "\u5C5E\u6027\u914D\u7F6E" }), _jsx("p", { className: "text-[10px] text-gray-400 mt-0.5", children: selectedField.type })] }), _jsxs("div", { className: "flex-1 overflow-y-auto p-4 space-y-6", children: [_jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u6807\u9898" }), _jsx("input", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all", value: selectedField.title, onChange: (e) => updateField(selectedField.id, { title: e.target.value }) })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u5B57\u6BB5\u6807\u8BC6 (ID)" }), _jsxs("div", { className: "flex gap-1", children: [_jsx("input", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2 bg-gray-50 text-gray-500 font-mono", value: selectedField.id, disabled: true }), _jsx("button", { className: "px-2 border border-gray-200 rounded hover:bg-gray-50 text-gray-500", title: "\u590D\u5236ID", onClick: () => navigator.clipboard.writeText(selectedField.id), children: "#" })] })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u63CF\u8FF0/\u63D0\u793A" }), _jsx("textarea", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all", rows: 2, value: selectedField.description || "", onChange: (e) => updateField(selectedField.id, { description: e.target.value }) })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u5360\u4F4D\u7B26" }), _jsx("input", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all", value: selectedField.placeholder || "", onChange: (e) => updateField(selectedField.id, { placeholder: e.target.value }) })] })] }), _jsxs("div", { className: "space-y-3 pt-4 border-t border-gray-100", children: [_jsx("h4", { className: "text-xs font-bold text-gray-900", children: "\u6821\u9A8C\u89C4\u5219" }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("input", { type: "checkbox", id: "required", checked: selectedField.required, onChange: (e) => updateField(selectedField.id, { required: e.target.checked }), className: "rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" }), _jsx("label", { htmlFor: "required", className: "text-sm text-gray-700", children: "\u5FC5\u586B\u9879" })] }), ["text", "textarea"].includes(selectedField.type) && (_jsxs(_Fragment, { children: [_jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u6B63\u5219\u6821\u9A8C" }), _jsx("select", { className: "w-full text-xs border border-gray-300 rounded px-2 py-1.5 mb-2", onChange: (e) => {
                                                    const preset = REGEX_PRESETS.find((p) => p.value === e.target.value);
                                                    if (preset) {
                                                        updateField(selectedField.id, {
                                                            validation: { pattern: preset.value, message: preset.msg }
                                                        });
                                                    }
                                                }, children: REGEX_PRESETS.map((p) => (_jsx("option", { value: p.value, children: p.label }, p.label))) }), _jsx("input", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2 font-mono text-xs", placeholder: "\u6B63\u5219\u8868\u8FBE\u5F0F", value: selectedField.validation?.pattern || "", onChange: (e) => updateField(selectedField.id, {
                                                    validation: { ...selectedField.validation, pattern: e.target.value }
                                                }) })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-medium text-gray-500", children: "\u9519\u8BEF\u63D0\u793A" }), _jsx("input", { className: "w-full text-sm border border-gray-300 rounded-md px-3 py-2", placeholder: "\u6821\u9A8C\u5931\u8D25\u65F6\u7684\u63D0\u793A\u4FE1\u606F", value: selectedField.validation?.message || "", onChange: (e) => updateField(selectedField.id, {
                                                    validation: { ...selectedField.validation, message: e.target.value }
                                                }) })] })] }))] }), ["select", "radio", "checkbox"].includes(selectedField.type) && (_jsxs("div", { className: "space-y-2 pt-4 border-t border-gray-100", children: [_jsx("h4", { className: "text-xs font-bold text-gray-900", children: "\u9009\u9879\u914D\u7F6E" }), _jsx(OptionsEditor, { options: selectedField.options, onChange: (opts) => updateField(selectedField.id, { options: opts }) })] })), selectedField.type === "array" && (_jsxs("div", { className: "space-y-3 pt-4 border-t border-gray-100", children: [_jsxs("h4", { className: "text-xs font-bold text-gray-900 flex justify-between items-center", children: ["\u5217\u8868\u5B57\u6BB5\u914D\u7F6E", _jsxs("span", { className: "text-[10px] font-normal text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded", children: [selectedField.subFields?.length || 0, " \u4E2A\u5B57\u6BB5"] })] }), _jsx("div", { className: "space-y-2", children: selectedField.subFields?.map((sub) => (_jsxs("div", { className: "flex items-center justify-between p-2 bg-gray-50 border border-gray-200 rounded group hover:border-indigo-300 transition-colors", children: [_jsxs("div", { className: "flex items-center gap-2 overflow-hidden", children: [_jsx("span", { className: "text-[10px] bg-gray-200 text-gray-600 px-1 rounded uppercase w-8 text-center", children: sub.type.slice(0, 3) }), _jsx("span", { className: "text-xs font-medium truncate", children: sub.title })] }), _jsxs("div", { className: "flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity", children: [_jsx("button", { onClick: () => setEditingSubFieldId(sub.id), className: "p-1 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded", children: _jsx(Edit2, { size: 12 }) }), _jsx("button", { onClick: () => removeSubField(selectedField.id, sub.id), className: "p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded", children: _jsx(Trash2, { size: 12 }) })] })] }, sub.id))) }), _jsx("div", { className: "grid grid-cols-4 gap-1 mt-2", children: SUB_FIELD_TYPES.map((t) => (_jsxs("button", { onClick: () => addSubField(selectedField.id, {
                                        id: `sub_${Date.now()}`,
                                        type: t.type,
                                        title: `新${t.label}`,
                                        required: false
                                    }), className: "text-[10px] border border-gray-200 bg-white hover:bg-indigo-50 hover:border-indigo-200 hover:text-indigo-600 py-1.5 rounded transition-colors", children: ["+ ", t.label] }, t.type))) })] }))] })] }));
};
export default PropertiesPanel;
